#!/bin/sh
# Update UFO after any edits other than with FontForge and prior to commit

# Stop on any errors
set -e

# Check and normalize all UFOs first -- assumes no other steps de-normalize
echo "Normalizing UFOs..."
psfnormalize -p checkfix=fix source/*-Regular.ufo  &
psfnormalize -p checkfix=fix source/*-Light.ufo    &
wait

echo "Updating glyph orders in Regular..."
psfsetglyphorder -q -p checkfix=none -p backup=False --header sort_final,sort_designer --field public.glyphOrder,com.schriftgestaltung.glyphOrder -i source/glyph_data.csv source/*-Regular.ufo

echo "Updating production names in Regular..."
psfsetpsnames -q -p checkfix=none -p backup=False -i source/glyph_data.csv source/*-Regular.ufo

echo "Syncing glyph orders, psnames, and other metadata to other UFOs..."
psfsyncmasters -q source/*.designspace

echo "Updating woff metadata file..."
psfmakewoffmetadata -q -n  Alkalami        -i org.sil.fonts source/*-Regular.ufo
# This line is probably not going to work right:
psfmakewoffmetadata -q -n "Alkalami Light" -i org.sil.fonts source/*-Light.ufo -o "AlkalamiLight-WOFF-metadata.xml"
